## 2.5 HTTP

---

### 2.5.1 HTTP/0

- 동작
    - 한 연결당 하나의 요청을 처리하도록 설계
- 문제
    - RTT (패킷 왕복 시간) 증가
- 해결 방법
    - 이미지 스플리팅
        - 이미지가 합쳐 있는 하나의 이미지를 다운로드 받고, background-image 의 position 을 이용하여 이미지 표기하는 방법
    - 코드 압축
        - 개행 문자, 빈칸을 없애서 코드 크기 최소화
    - 이미지 Base64 인코딩
        - 이미지 파일을 64진법으로 이루어진 문자열로 인코딩
        - 이미지에 대해 HTTP 요청을 할 필요가 없음

### 2.5.2 HTTP/1.1

- 동작
    - TCP 초기화 → keep-alive 라는 옵션을 통해 여러 개의 파일을 송수신 가능
- 특징
    - 한 번 3-way handshake 발생하면 그 이후 발생하지 않음
    - 리소스 개수에 비례해서 대기 시간이 길어지는 단점
- HOL Blocking
    - Head Of Line Blocking
    - 네트워크에서 같은 큐에 있는 패킷이 첫번 째 패킷에 의해 지연될 때 발생하는 성능 저하 현상
- 무거운 헤더 구조
    - 헤더에 많은 데이터가 들어가 있고 압축 되지 않아 무거움

### 2.5.3 HTTP/2

- 멀티 플렉싱
    - 여러 개의 스트림을 사용하여 송수신
    - 특정 스트림의 패킷이 손실되어도 해당 스트림에만 영향을 미침
    - 단일 연결을 사용하여 병렬로 여러 요청을 받을 수 있고 응답을 줄일 수 있음
    - HOL Blocking 해결 가능
- 헤더 압축
    - HPACK 압축 형식 (허프만 코딩 압축 알고리즘 사용)
        - 허프만 코딩 : 문자열을 문자 단위로 쪼개 빈도수를 세어 빈도가 높은 정보는 적은 비트 수를 사용하여 표현, 빈도가 낮은 정보는 비트 수를 많이 사용하여 표현 ⇒ 데이터 표현 비트양을 줄임
- 서버 푸시
    - 클라이언트 요청 없이 서버가 바로 리소스 푸시 가능

### 2.5.4 HTTPS

- 의미
    - 애플리케이션 계층과 전송 계층 사이에 신뢰 계층을 넣은 신뢰할 수 있는 HTTP 요청
    - 통신 암호화
- SSL/TLS
    - Secure Socket Layer, Transport Layer Security Protocol
    - 전송계층에서 보안을 제공하는 프로토콜
    - 제 3자가 메시지를 도청하거나 변조하지 못하게 막음
    - 보안 세션을 기반으로 데이터 암호화
    - 인증 메커니즘, 키 교환 암호화 알고리즘, 해싱 알고리즘 사용

- 보안세션
    - 의미
        - 보안이 시작되고 끝나는 동안 유지되는 세션
    - 특징
        - 핸드셰이크를 통해 보안 세션 생성 → 상태 정보 공유
        - 클라이언트 - 서버와 키 공유하여 작업
    - 동작 순서
        - 클라이언트 → 서버 : 사이퍼 슈트 전달
        - 서버 : 사이퍼 슈트의 암호화 알고리즘 리스트 제공할 수 있는지 확인
        - 서버 → 클라이언트 : 인증서 보냄
        - 인증 메커니즘 이후 해싱 알고리즘으로 암호화된 데이터 송수신 시작

> `사이퍼 슈트` : 프로토콜, AEAD 사이퍼 모드, 해싱 알고리즘이 나열된 규약. 총 5개 존재
> 

- 인증메커니즘
    - CA 에서 발급한 인증서를 기반으로 이루어짐
    - 공개키를 클라이언트에 제공
    - 사용자가 접속한 서버가 신뢰할 수 있는 서버임을 보장
    - 서비스 정보, 공개키, 지문, 디지털 서명등으로 이루어져 있음
    - CA 발급과정
        - 자신의 사이트 정보와 공개키를 CA에 제출
        - CA는 공개키를 해시한 값을 기반으로 CA 인증서 발급
- 암호화 알고리즘
    - 대수곡선 기반의 ECDHE
    - 모듈식 기반의 DHE
    - 둘 다 디피-헬만 방식을 근간으로 만들어짐
        - 처음에 공개 값을 공유 → 각자의 비밀 값과 혼합한 후 혼합 값을 공유 → 각자의 비밀 값과 또 혼합 → 공통의 암호키 PSK(Pre-Shared Key) 생성
        - 클라이언트와 서버 모두 개인키와 공개키 생성
        - 서로에게 공개키 보내고 공개키와 개인키를 결합하여 PSK 생성
- 해싱 알고리즘
    - SHA-256 알고리즘을 많이 사용
        - 해시 함수의 결괏값이 256비트인 알고리즘
        - 블록체인 시스템에서도 사용
        - 해싱 해야할 메시지에 1을 추가하는 등 전처리 후 전처리된 메세지를 기반으로 해시 반환

- HTTPS 구축방법
    - 직접 CA에서 구매한 인증키를 기반으로 HTTPS 서비스 구축
    - 서버 앞단에 HTTPS 를 제공하는 로드밸런스 구축
    - 서버 앞단에 HTTPS 를 제공하는 CDN 구축

### 2.5.5 HTTP/3

- QUIC 라는 계층 위에서 UDP 기반으로 돌아감
    - cf. HTTP/2 → TCP 위에서 돌아감
- 초기 연결 설정 시 지연 시간 감소
- 첫 연결 설정에 1-RTT 만 소요됨
- 순방향 오류 수정 메커니즘 적용
    - 전송한 패킷이 손실되었다면, 수신 측에서 에러 검출하고 수정하는 방식
    - 열악한 네트워크 환경에서도 낮은 패킷 손실률
