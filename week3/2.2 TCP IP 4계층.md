## 2.2 TCP/IP 4계층

---

### 2.2.1 계층 구조

- 애플리케이션 계층
    - 응용 프로그램이 사용되는 프로토콜 계층
    - 웹 서비스, 이메일 등 서비스를 실질적으로 제공하는 계층
    - FTP, HTTP, SSH, SMTP, DNS 등이 사용되는 계층
        - FTP : 장치와 장치 간의 파일을 전송하는 데 사용
        - SSH : 암호화 네트워크 프로토콜
        - HTTP : 웹 사이트를 이용하는 데 쓰는 프로토콜
        - SMTP : 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜
        - DNS : 도메인 이름과 IP 주소를 매핑해주는 서버
- 전송 계층
    - 송신자와 수신자를 연결하는 통신 서비스 제공
    - 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어 제공
    - 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중계 역할
    - TCP
        - 패킷 사이의 순서를 보장
        - 연결 지향 프로토콜을 사용해서 연결
        - 신뢰성을 구축해서 수신 여부 확인
        - 가상회선 패킷 교환 방식 사용
            - 가상 회선에 따라 순서대로 도착
            - 3-way handshake 작업 진행
    - UDP
        - 순서를 보장하지 않음
        - 수신 여부를 확인하지 않음
        - 단순히 데이터만 주고 받음
        - 데이터그램 패킷 교환 방식 사용
            - 최적의 경로를 선택하여 다른 경로로 전송될 수 있음
            - 순서 다르게 도착 할 수도 있음
- 인터넷 계층
    - 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층
    - 패킷을 수신해야할 상대의 주소를 지정하여 데이터 전달
    - 상대방이 제대로 받았는지 보장하지 않는 비연결형적인 특징
    - IP, ARP, ICMP
- 링크 계층
    - 실질적으로 데이터를 전달하는 계층
    - 장치 간에 신호를 주고받는 ‘규칙’을 정하는 계층
    - 네트워크 접근 계층
    - 물리계층과 데이터링크계층으로 나누기도 함
        - 물리계층 : 무선 LAN, 유선 LAN을 통해 0과 1로 이루어진 데이터를 보내는 계층
        - 데이터링크계층 : 이더넷 프레임을 통해 에러 확인, 흐름 제어, 접근 제어를 담당하는 계층

**⚠️TCP 연결 성립 과정 : 3-way handshake**

1. SYN : 클라이언트 → 서버, ISN을 담아 SYN(연결요청 플래그 보냄)
2. SYN + ACK : 서버 → 클라이언트, SYN 수신 + 클라이언트에게 ISN+1 보냄
3. ACK : 클라이언트 → 서버, ISN + 1 번호를 담아 ACK 보냄

**⚠️TCP 연결 해제 과정 : 4-way handshake**

1. 클라이언트 : FIN 으로 설정된 세그먼트 보냄. 클라이언트는 FIN_WAIT_1 상태로 들어감 + 서버의 응답 기다림
2. 서버 : ACK 승인 세그먼트 보냄 + CLOSE_WAIT 상태 들어감. 클라이언트가 세그먼트를 받으면 FIN_WAIT_2 상태 들어감
3. 서버 : ACK 를 보내고 일정 시간 후 클라이언트에 FIN 세그먼트 보냄
4. 클라이언트 : TIME_WAIT  상태. 서버에 다시 ACK 보냄. 서버는 CLOSE 상태 됨. 클라이언트는 일정시간 대기 후 연결이 닫히고 자원 연결 해제. (지연 패킷 발생할 경우 대비, 두 장치 연결이 닫혔는지 확인하기 위해)

### 2.2.2 PDU

- 정의
    - 네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 단위
- 구성
    - 헤더 : 제어 관련 정보
    - 페이로드 : 데이터
- 명칭
    - 애플리케이션 계층 → 메시지
    - 전송 계층 → 세그먼트(TCP), 데이터그램(UDP)
    - 인터넷 계층 → 패킷
    - 링크 계층 → 프레임(데이터링크), 비트(물리)
